---
import Layout from "../../../layouts/Layout.astro";
import { db } from "../../../db";
import { events } from "../../../db/schemas";
import { eq } from "drizzle-orm";
import { GuestInteractionFlow } from "../../../components/eventos/GuestInteractionFlow";

const { codigoAcceso } = Astro.params;

if (!codigoAcceso) {
  return Astro.redirect("/404");
}

// Buscar evento por código de acceso
const evento = await db
  .select()
  .from(events)
  .where(eq(events.codigoAcceso, codigoAcceso))
  .get();

if (!evento) {
  return Astro.redirect("/404");
}

// Verificar que el evento esté activo
if (evento.estado !== "activo") {
  return new Response("Este evento ha finalizado", { status: 410 });
}
---

<Layout title={`Subir fotos - ${evento.name}`}>
  <div
    class="min-h-screen bg-linear-to-br from-blue-50 via-white to-purple-50 py-12 px-4 sm:px-6 lg:px-8"
  >
    <div class="max-w-2xl mx-auto">
      <!-- Header del evento -->
      <div class="text-center mb-8">
        <div
          class="inline-flex items-center justify-center w-16 h-16 bg-blue-600 rounded-full mb-4"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-8 w-8 text-white"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"
            ></path>
          </svg>
        </div>
        <h1 class="text-4xl font-bold text-gray-900 mb-2">{evento.name}</h1>
        <p class="text-lg text-gray-600">¡Comparte tus mejores momentos!</p>
        <p class="text-sm text-gray-500 mt-2">
          Sube 2 fotos que se mostrarán en la galería del evento
        </p>
      </div>

      <!-- Flujo de interacción del invitado -->
      <div class="mt-4">
        <GuestInteractionFlow
          codigoEvento={codigoAcceso!}
          nombreEvento={evento.name}
          client:load
        />
      </div>

      <!-- Información adicional -->
      <div class="mt-6 text-center text-sm text-gray-500">
        <p>Las fotos se mostrarán en tiempo real en la galería</p>
        <p class="mt-1">Tamaño máximo por imagen: 5MB</p>
      </div>
    </div>
  </div>
</Layout>

<style>
  /* Animación sutil para el header */
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  h1,
  p {
    animation: fadeInUp 0.6s ease-out;
  }
</style>
