---
import Layout from "../../layouts/Layout.astro";

const user = Astro.locals.user;
if (!user) {
  return Astro.redirect("/login");
}
---

<Layout title="Crear Servicio | Galeria Rayuela">
  <div class="container mx-auto p-4 max-w-2xl pt-10">
    <div class="mb-8">
      <a
        href="/services"
        class="text-gray-400 hover:text-white flex items-center gap-1 text-sm mb-4 transition-colors"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-4 w-4"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15 19l-7-7 7-7"></path>
        </svg>
        Volver a Mis Servicios
      </a>
      <h1 class="text-3xl font-bold text-white">Nuevo Servicio</h1>
      <p class="text-gray-400">Ofrece tus habilidades en el Marketplace.</p>
    </div>

    <form class="glass-card p-8 space-y-6" id="createServiceForm">
      <div>
        <label class="block text-sm font-medium text-gray-300 mb-1"
          >Nombre del Servicio</label
        >
        <input
          type="text"
          name="name"
          required
          class="glass-input w-full"
          placeholder="ej. Fotografía de Bodas, DJ Set, Catering..."
        />
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-300 mb-1"
          >Descripción</label
        >
        <textarea
          name="description"
          rows="4"
          required
          class="glass-input w-full"
          placeholder="Describe qué incluye tu servicio..."></textarea>
      </div>

      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-1"
            >Precio</label
          >
          <div class="relative">
            <span class="absolute left-3 top-2 text-gray-400">$</span>
            <input
              type="number"
              name="price"
              required
              min="0"
              step="0.01"
              class="glass-input w-full pl-8"
              placeholder="0.00"
            />
          </div>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-1"
            >Unidad de Cobro</label
          >
          <select name="unit" class="glass-input w-full bg-midnight-900">
            <option value="hora">Por Hora</option>
            <option value="evento">Por Evento</option>
            <option value="persona">Por Persona</option>
            <option value="foto">Por Foto</option>
          </select>
        </div>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-300 mb-1"
          >Categoría</label
        >
        <select name="category" class="glass-input w-full bg-midnight-900">
          <option value="fotografia">Fotografía</option>
          <option value="video">Video</option>
          <option value="dj">DJ / Música</option>
          <option value="catering">Catering</option>
          <option value="salon">Salón / Espacio</option>
          <option value="animacion">Animación</option>
          <option value="otro">Otro</option>
        </select>
      </div>

      <div class="pt-4">
        <button type="submit" class="glass-button w-full justify-center"
          >Publicar Servicio</button
        >
      </div>
    </form>
  </div>
</Layout>

<script>
  const form = document.getElementById("createServiceForm") as HTMLFormElement;
  form?.addEventListener("submit", async (e) => {
    e.preventDefault();
    const formData = new FormData(form);
    const data = Object.fromEntries(formData);

    try {
      const res = await fetch("/api/services", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data),
      });

      if (res.ok) {
        window.location.href = "/services";
      } else {
        alert("Error al crear servicio");
      }
    } catch (error) {
      console.error(error);
      alert("Error al crear servicio");
    }
  });
</script>
