---
const currentPath = Astro.url.pathname;
const isActive = (path: string) =>
  currentPath === path
    ? "border-neon-blue text-white"
    : "border-transparent text-gray-500 hover:text-gray-300";

import { db } from "../../db";
import { whatsappSesiones } from "../../db/schemas";
import { eq } from "drizzle-orm";

const user = Astro.locals.user;
let whatsappStatus = "no_configurado";

if (user) {
  const sesion = await db
    .select()
    .from(whatsappSesiones)
    .where(eq(whatsappSesiones.usuarioId, user.id))
    .get();

  if (sesion) {
    whatsappStatus = sesion.estado;
  }
}
---

<div
  class="flex gap-2 w-full items-center z-50 justify-center sm:gap-8 border-b border-white/10 mb-10 overflow-x-auto no-scrollbar scroll-smooth"
>
  <a
    href="/dashboard"
    class={`tab-btn px-4 py-4 cursor-pointer text-[11px] font-black uppercase tracking-[0.2em] transition-all border-b-2 whitespace-nowrap ${isActive("/dashboard")}`}
  >
    Eventos
  </a>

  <a
    href="/dashboard/servicios"
    class={`tab-btn px-4 py-4 text-[11px] font-black uppercase tracking-[0.2em] transition-all border-b-2 border-transparent cursor-pointer whitespace-nowrap ${isActive("/dashboard/servicios")}`}
  >
    Servicios
  </a>
  <a
    href="/dashboard/perfil"
    class={`tab-btn px-4 py-4 text-[11px] font-black uppercase tracking-[0.2em] transition-all border-b-2 cursor-pointer whitespace-nowrap ${isActive("/dashboard/perfil")}`}
  >
    Perfil
  </a>

  <a
    href="/dashboard/perfil#whatsapp"
    class={`tab-btn px-4 py-4 text-[11px] font-black uppercase tracking-[0.2em] transition-all border-b-2 border-transparent cursor-pointer whitespace-nowrap flex items-center gap-2 ${whatsappStatus === "activo" ? "text-green-400" : "text-gray-500"}`}
  >
    WhatsApp
    <span
      class={`flex h-2 w-2 rounded-full ${whatsappStatus === "activo" ? "bg-green-400 animate-pulse" : whatsappStatus === "pendiente" ? "bg-yellow-400" : "bg-gray-600"}`}
    ></span>
  </a>
</div>
